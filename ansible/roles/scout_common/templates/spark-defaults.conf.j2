{% if not aws_deployment %}
spark.hadoop.fs.s3a.access.key {{ spark_s3_username | default(s3_lake_reader) }}
spark.hadoop.fs.s3a.secret.key {{ spark_s3_password | default(s3_lake_reader_secret) }}
{% endif %}
{% if s3_endpoint | default('') %}
spark.hadoop.fs.s3a.endpoint {{ s3_endpoint }}
{% endif %}
spark.hadoop.fs.s3a.endpoint.region {{ s3_region | default('us-east-1') }}
spark.databricks.delta.schema.autoMerge.enabled true
spark.databricks.delta.merge.repartitionBeforeWrite.enabled true
spark.databricks.delta.constraints.allowUnenforcedNotNull.enabled true
spark.sql.extensions io.delta.sql.DeltaSparkSessionExtension
spark.sql.catalog.spark_catalog org.apache.spark.sql.delta.catalog.DeltaCatalog
spark.hadoop.fs.s3a.path.style.access {{ aws_deployment | ternary('false', 'true') }}
spark.hadoop.hive.metastore.uris {{ spark_hive_metastore_uri | default(hive_metastore_endpoint) }}
spark.sql.warehouse.dir {{ delta_lake_path }}
spark.driver.extraJavaOptions -Divy.cache.dir=/tmp -Divy.home=/tmp
spark.executor.memory {{ spark_memory | default('1G') }}
spark.driver.memory {{ spark_memory | default('1G') }}
{% if not aws_deployment %}
spark.hadoop.fs.s3a.aws.credentials.provider org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider
{% else %}
spark.hadoop.fs.s3a.aws.credentials.provider com.amazonaws.auth.WebIdentityTokenCredentialsProvider
{% endif %}
